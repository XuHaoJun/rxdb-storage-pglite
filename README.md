# RxDB PgLite

This is a plugin for [RxDB](https://rxdb.info/) that allows you to use [PGLite](https://github.com/electric-sql/pglite) as a storage engine.

Most of the code is generated by cursor, still working in progress. need more test.

## Installation

```bash
npm install @xuhaojun/rxdb-storage-pglite @electric-sql/pglite
```

## Usage

```typescript
import { getRxStoragePGLite } from "@xuhaojun/rxdb-storage-pglite";

// nodejs with local file storage
const myDatabase = await createRxDatabase<YourCollections>({
    name: "test",
    storage: getRxStoragePGLite({ path: path.join(__dirname, "test.db") }),
});

// browser with indexedDB storage
const myDatabase = await createRxDatabase<YourCollections>({
    name: "test",
    storage: getRxStoragePGLite({ path: "idb://test" }),
});

// expo with expo-file-system
import * as FileSystem from "expo-file-system";
const myDatabase = await createRxDatabase<YourCollections>({
    name: "test",
    storage: getRxStoragePGLite({
        path: FileSystem.documentDirectory + "test.db",
    }),
});
```

## How it works

Create a SQL Table for each collection.

```sql
CREATE TABLE your_collection_name (
    id TEXT PRIMARY KEY,
    data JSONB NOT NULL DEFAULT '{}'
);
```

The `data` column is a JSONB column that stores the document data.

Translate the RxDB query to the SQL query by [mongo-query-to-postgres-jsonb](https://github.com/thomas4019/mongo-query-to-postgres-jsonb)
